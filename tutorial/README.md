# KAMA + ATR ç­–ç•¥æ•™ç¨‹

ä»ç—…æ¯’å¼ä¼ æ’­çš„ 5394% æ”¶ç›Šåˆ°ç°å®éªŒè¯

## ğŸ“– æ•™ç¨‹è¯´æ˜

è¿™ä¸ªæ•™ç¨‹å¤ç°äº†ä¸€ä¸ªç»å…¸çš„é‡åŒ–äº¤æ˜“æ¡ˆä¾‹ç ”ç©¶ï¼Œå±•ç¤ºäº†ï¼š

1. **è¿‡æ‹Ÿåˆçš„å±é™©**ï¼šä¸ºä»€ä¹ˆ"å®Œç¾"çš„å›æµ‹ç»“æœä¸å¯ä¿¡
2. **æ­£ç¡®çš„éªŒè¯æ–¹æ³•**ï¼šå¦‚ä½•ä½¿ç”¨è®­ç»ƒ/æµ‹è¯•åˆ†å‰²é¿å…è¿‡æ‹Ÿåˆ
3. **ç‰¹å¾å·¥ç¨‹çš„é‡è¦æ€§**ï¼šå¦‚ä½•åˆ›å»ºç¨³å¥çš„æœºå™¨å­¦ä¹ ç‰¹å¾
4. **ä¸‰é‡éšœç¢æ³•**ï¼šå¦‚ä½•ç§‘å­¦åœ°å®šä¹‰äº¤æ˜“æˆåŠŸæ ‡å‡†
5. **è§„åˆ™ vs ML**ï¼šä¼ ç»Ÿè§„åˆ™ç­–ç•¥ä¸æœºå™¨å­¦ä¹ æ–¹æ³•çš„å¯¹æ¯”

## ğŸ“ æ–‡ä»¶ç»“æ„

```
tutorial/
â”œâ”€â”€ __init__.py                 # æ¨¡å—åˆå§‹åŒ–
â”œâ”€â”€ feature_engineering.py      # ç‰¹å¾å·¥ç¨‹ï¼ˆ9ä¸ªæ ‡å‡†åŒ–ç‰¹å¾ï¼‰
â”œâ”€â”€ labeling.py                 # ä¸‰é‡éšœç¢æ³•æ ‡è®°
â”œâ”€â”€ kama_atr_strategy.py        # ç­–ç•¥å®ç°ï¼ˆè§„åˆ™ + MLï¼‰
â”œâ”€â”€ run_example.py              # ä¸»è¿è¡Œè„šæœ¬
â””â”€â”€ README.md                   # æœ¬æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œå®Œæ•´ç¤ºä¾‹

```bash
# ä»é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
python tutorial/run_example.py

# æˆ–ä» tutorial ç›®å½•è¿è¡Œ
cd tutorial
python run_example.py
```

### æµ‹è¯•å•ä¸ªæ¨¡å—

```bash
# æµ‹è¯•ç‰¹å¾å·¥ç¨‹
python tutorial/feature_engineering.py

# æµ‹è¯•ä¸‰é‡éšœç¢æ³•
python tutorial/labeling.py

# æµ‹è¯•ç­–ç•¥
python tutorial/kama_atr_strategy.py
```

## ğŸ“Š ç¤ºä¾‹è¾“å‡º

ç¨‹åºä¼šè¾“å‡ºï¼š

### ç¬¬ä¸€éƒ¨åˆ†ï¼šè§„åˆ™ç­–ç•¥æµ‹è¯•

- ä½¿ç”¨å›ºå®šè§„åˆ™ï¼ˆä»·æ ¼ > KAMAï¼ŒATR% åœ¨ 1%-3%ï¼‰
- ç®€å•å›æµ‹ç»“æœ
- å±•ç¤ºè§„åˆ™ç­–ç•¥çš„å±€é™æ€§

**ç¤ºä¾‹ç»“æœ**ï¼š
- æ€»æ”¶ç›Šç‡ï¼š9.05%
- äº¤æ˜“æ¬¡æ•°ï¼š94
- èƒœç‡ï¼š35.1%
- å¤æ™®æ¯”ç‡ï¼š0.19

### ç¬¬äºŒéƒ¨åˆ†ï¼šæœºå™¨å­¦ä¹ ç­–ç•¥

- è‡ªåŠ¨ç‰¹å¾å·¥ç¨‹ï¼ˆ9ä¸ªæ ‡å‡†åŒ–ç‰¹å¾ï¼‰
- ä¸‰é‡éšœç¢æ³•æ ‡è®°ï¼ˆå®šä¹‰æˆåŠŸæ ‡å‡†ï¼‰
- LightGBM æ¨¡å‹è®­ç»ƒ
- æ ·æœ¬å¤–æµ‹è¯•éªŒè¯

**å…³é”®å‘ç°**ï¼š
- æœ€é‡è¦ç‰¹å¾ï¼š`feature_price_sma200_dist`ï¼ˆé•¿æœŸè¶‹åŠ¿ï¼‰
- ç¬¬äºŒé‡è¦ï¼š`feature_atr_pct`ï¼ˆæ³¢åŠ¨æ€§ï¼‰
- æ¨¡å‹è‡ªåŠ¨éªŒè¯äº†åŸå§‹ç­–ç•¥çš„æ ¸å¿ƒæ€æƒ³

### ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ€»ç»“æŠ¥å‘Š

- ç­–ç•¥å¯¹æ¯”è¡¨æ ¼
- æ ¸å¿ƒç»éªŒæ€»ç»“
- 5ä¸ªå…³é”®æ•™è®­

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### 1. ç‰¹å¾æ ‡å‡†åŒ–

```python
# âŒ é”™è¯¯ï¼šä½¿ç”¨åŸå§‹å€¼
feature = df['macd_hist']  # $2.00 åœ¨ä¸åŒä»·æ ¼æ°´å¹³ä¸‹å«ä¹‰ä¸åŒ

# âœ… æ­£ç¡®ï¼šæ ‡å‡†åŒ–ä¸ºç™¾åˆ†æ¯”
feature = df['macd_hist'] / df['close']  # è·¨æ—¶æœŸå¯æ¯”
```

### 2. ä¸‰é‡éšœç¢æ³•

ä¸ºæ¯ä¸ªäº¤æ˜“è®¾ç½®ä¸‰ä¸ªé€€å‡ºæ¡ä»¶ï¼š
1. **æ­¢ç›ˆ**ï¼šä»·æ ¼ä¸Šæ¶¨åˆ°ç›®æ ‡ä½ï¼ˆå¦‚ 3x ATRï¼‰
2. **æ­¢æŸ**ï¼šä»·æ ¼ä¸‹è·Œåˆ°æ­¢æŸä½ï¼ˆå¦‚ 3x ATRï¼‰
3. **è¶…æ—¶**ï¼šè¾¾åˆ°æœ€å¤§æŒä»“å¤©æ•°ï¼ˆå¦‚ 15 å¤©ï¼‰

ç¬¬ä¸€ä¸ªè§¦åŠçš„éšœç¢å†³å®šæ ‡ç­¾ï¼ˆ1=æˆåŠŸï¼Œ0=å¤±è´¥ï¼‰

### 3. é¿å…è¿‡æ‹Ÿåˆ

```python
# âŒ é”™è¯¯ï¼šåœ¨å…¨æ•°æ®é›†ä¸Šä¼˜åŒ–
# ç»“æœï¼š5394% æ”¶ç›Šï¼ˆä¸çœŸå®ï¼‰

# âœ… æ­£ç¡®ï¼šè®­ç»ƒ/æµ‹è¯•åˆ†å‰²
# è®­ç»ƒé›†ï¼š70% å†å²æ•°æ®
# æµ‹è¯•é›†ï¼š30% æœ€è¿‘æ•°æ®ï¼ˆæ¨¡æ‹ŸçœŸå®äº¤æ˜“ï¼‰
# ç»“æœï¼šæ›´ä½ä½†æ›´å¯ä¿¡çš„æ”¶ç›Š
```

## ğŸ” è¯¦ç»†ä»£ç è¯´æ˜

### feature_engineering.py

**æ ¸å¿ƒå‡½æ•°**ï¼š
- `calculate_technical_indicators()` - è®¡ç®— KAMAã€ATRã€RSIã€MACD ç­‰
- `create_normalized_features()` - åˆ›å»º 9 ä¸ªæ ‡å‡†åŒ–ç‰¹å¾
- `prepare_data_for_ml()` - ä¸€ç«™å¼æ•°æ®å‡†å¤‡

**9 ä¸ªç‰¹å¾**ï¼š
1. `feature_atr_pct` - ATR ç™¾åˆ†æ¯”ï¼ˆæ³¢åŠ¨æ€§ï¼‰
2. `feature_price_kama_dist` - ä»·æ ¼ä¸ KAMA çš„è·ç¦»
3. `feature_price_sma200_dist` - ä»·æ ¼ä¸ 200 æ—¥å‡çº¿çš„è·ç¦»
4. `feature_rsi` - æ ‡å‡†åŒ– RSIï¼ˆ0-1ï¼‰
5. `feature_macdhist` - æ ‡å‡†åŒ– MACD æŸ±çŠ¶å›¾
6. `feature_bb_position` - å¸ƒæ—å¸¦ä½ç½®
7. `feature_momentum_5` - 5 æ—¥åŠ¨é‡
8. `feature_momentum_20` - 20 æ—¥åŠ¨é‡
9. `feature_volume_ratio` - æˆäº¤é‡æ¯”ç‡

### labeling.py

**æ ¸å¿ƒå‡½æ•°**ï¼š
- `label_with_triple_barrier()` - ä½¿ç”¨ä¸‰é‡éšœç¢æ³•æ ‡è®°
- `optimize_barrier_parameters()` - ä¼˜åŒ–éšœç¢å‚æ•°

**æ ‡è®°é€»è¾‘**ï¼š
```python
for æ¯ä¸ªäº¤æ˜“æ—¥:
    è®¾ç½®æ­¢ç›ˆ = å…¥åœºä»· + (3 Ã— ATR)
    è®¾ç½®æ­¢æŸ = å…¥åœºä»· - (3 Ã— ATR)
    
    å‘å‰æŸ¥çœ‹æœ€å¤š 15 å¤©:
        if è§¦åŠæ­¢ç›ˆ:
            æ ‡ç­¾ = 1ï¼ˆæˆåŠŸï¼‰
        elif è§¦åŠæ­¢æŸ:
            æ ‡ç­¾ = 0ï¼ˆå¤±è´¥ï¼‰
        elif è¶…æ—¶:
            æ ‡ç­¾ = 0ï¼ˆå¤±è´¥ï¼‰
```

### kama_atr_strategy.py

**ä¸¤ä¸ªç­–ç•¥ç±»**ï¼š

1. `RuleBasedKAMAStrategy` - è§„åˆ™ç­–ç•¥
   - å›ºå®šçš„è¿›åœº/å‡ºåœºè§„åˆ™
   - ç®€å•å›æµ‹åŠŸèƒ½
   - å±•ç¤ºè¿‡æ‹Ÿåˆé—®é¢˜

2. `MLKAMAStrategy` - ML ç­–ç•¥
   - è‡ªåŠ¨ç‰¹å¾å­¦ä¹ 
   - LightGBM æ¨¡å‹
   - è®­ç»ƒ/æµ‹è¯•åˆ†å‰²
   - ç‰¹å¾é‡è¦æ€§åˆ†æ

## ğŸ“ˆ æ‰©å±•ç»ƒä¹ 

1. **å°è¯•ä¸åŒçš„è‚¡ç¥¨**ï¼š
   ```python
   # åœ¨ run_example.py ä¸­ä¿®æ”¹
   symbol = "AAPL"  # æˆ– "TSLA", "SPY" ç­‰
   ```

2. **è°ƒæ•´ä¸‰é‡éšœç¢å‚æ•°**ï¼š
   ```python
   ml_strategy = MLKAMAStrategy(
       profit_target_mult=4.0,  # å¢åŠ æ­¢ç›ˆç›®æ ‡
       stop_loss_mult=2.0,      # é™ä½æ­¢æŸ
       eval_bars=20             # å¢åŠ æœ€å¤§æŒä»“å¤©æ•°
   )
   ```

3. **æ·»åŠ æ–°ç‰¹å¾**ï¼š
   åœ¨ `feature_engineering.py` ä¸­æ·»åŠ è‡ªå·±çš„ç‰¹å¾

4. **ä¼˜åŒ–æ¨¡å‹å‚æ•°**ï¼š
   åœ¨ `kama_atr_strategy.py` ä¸­è°ƒæ•´ LightGBM å‚æ•°

## ğŸ’¡ å…³é”®ç»éªŒ

1. **è­¦æƒ•å®Œç¾çš„å›æµ‹ç»“æœ**
   - 5394% çš„æ”¶ç›Šï¼Ÿé‚£æ˜¯æ›²çº¿æ‹Ÿåˆ
   - çœŸå®äº¤æ˜“ä¸­ä¼šè¿…é€Ÿå¤±æ•ˆ

2. **ä½¿ç”¨æ­£ç¡®çš„éªŒè¯æ–¹æ³•**
   - âœ… è®­ç»ƒ/æµ‹è¯•åˆ†å‰²
   - âœ… æ­¥è¿›å¼åˆ†æ
   - âŒ å…¨æ•°æ®é›†ä¼˜åŒ–

3. **ç‰¹å¾å·¥ç¨‹æ˜¯å…³é”®**
   - æ ‡å‡†åŒ–ä½¿ç‰¹å¾è·¨æ—¶æœŸå¯æ¯”
   - åŸå§‹å€¼åœ¨ä¸åŒä»·æ ¼æ°´å¹³ä¸‹æ— æ„ä¹‰

4. **æœºå™¨å­¦ä¹ ä¸æ˜¯ä¸‡èƒ½çš„**
   - éœ€è¦è‰¯å¥½çš„ç‰¹å¾å·¥ç¨‹
   - éœ€è¦æ­£ç¡®çš„æ ‡è®°æ–¹æ³•
   - éœ€è¦ä¸¥æ ¼çš„éªŒè¯æµç¨‹

5. **é£é™©è°ƒæ•´åçš„æ”¶ç›Šæ‰é‡è¦**
   - 376% + ä½å›æ’¤ > 5394% è¿‡æ‹Ÿåˆå¹»è§‰

## ğŸ”— å‚è€ƒèµ„æº

- [åŸæ–‡ï¼šWe Backtested a Viral Trading Strategy](https://medium.com/@richardshu)
- [AlphaSuite GitHub](https://github.com/username/AlphaSuite)
- [TA-Lib æ–‡æ¡£](https://ta-lib.org/)
- [LightGBM æ–‡æ¡£](https://lightgbm.readthedocs.io/)

## ğŸ“ è®¸å¯

æœ¬æ•™ç¨‹æ˜¯ AlphaSuite é¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œéµå¾ª MIT è®¸å¯è¯ã€‚